default: &default
  before_rails:
    # Mongoid support - replace C66 provided mongoid with custom config
    - source: /.cloud66/mongoid.yml
      destination: $STACK_PATH/config/mongoid.yml
      target: rails
    # Install bower-rails dependencies
    - command: cd $STACK_PATH && bundle exec rake bower:install
      target: rails
  after_rails:
    # Migrate and seed database
    - command: cd $STACK_PATH && bundle exec rake db:migrate && bundle exec rake db:seed
      target: rails
    # Correct permissions of assets for paperclip
    - command: sudo chmod 0777 -R $RAILS_STACK_PATH/public/*
      target: rails
      sudo: true
    # Rebuild elasticsearch indexes
    - command: /.cloud66/elastic-search.sh
      target: rails

production:
  <<: *default

development:
  <<: *default
